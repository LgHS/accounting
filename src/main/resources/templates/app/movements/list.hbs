{{#partial "title"}}
    Movement list
{{/partial}}

{{#partial "content"}}
    <table>
        <thead>
        <tr>
            <th>entry date</th>
            <th>from</th>
            <th>amount</th>
            <th>communication</th>
            <th>category</th>
            <th>actions</th>
        </tr>
        </thead>
        <tbody>
        {{#each movements}}
            <tr id="{{this.id}}" {{#lt this.amount.signum 0}}class="bg-light-red"{{/lt}}>
                <td>{{this.entryDate}}</td>
                <td>{{this.counterPartyName}} (<a href="/app/movements/by-iban/{{this.counterPartyAccountNumber}}">{{this.counterPartyAccountNumber}}</a>)</td>
                <td class="align-right">{{this.amount}}</td>
                <td>{{this.communication}}</td>
                <td>
                    {{#if this.categoryId}}
                        âœ“
                        {{#each categories}}
                            {{!-- this is highly inefficient, I blame handlebar's terrible syntax. --}}
                            {{#eq @../this.categoryId this.id}}
                                <a href="/app/movements/by-category/{{this.id}}">{{this.name}}</a>
                            {{/eq}}
                        {{/each}}
                    {{else}}
                        <form action="/app/movements/{{this.id}}/category" method="post">
                            <input type="hidden" name="{{#csrf_param}}{{/csrf_param}}"
                                   value="{{#csrf_token}}{{/csrf_token}}">
                            <select name="category_id">
                                <option value="">Select a category</option>
                                {{#each categories}}
                                    {{#gt @../this.amount.signum 0}}
                                        {{#eq this.type 'CREDIT'}}
                                            <option value="{{this.id}}">{{this.name}}</option>
                                        {{/eq}}
                                    {{else}}
                                        {{#eq this.type 'DEBIT'}}
                                            <option value="{{this.id}}">{{this.name}}</option>
                                        {{/eq}}
                                    {{/gt}}
                                {{/each}}
                            </select>
                            <input type="submit">
                        </form>
                    {{/if}}
                </td>
                <td>
                    <a href="/app/movements/{{this.id}}">view</a>
                    <a href="/app/movements/{{this.id}}/split">split</a>
                </td>
            </tr>
        {{else}}
            <tr>
                <td colspan="2">no data yet</td>
            </tr>
        {{/each}}
        </tbody>
    </table>
{{/partial}}

{{> layout}}
